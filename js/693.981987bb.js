"use strict";(self["webpackChunkblog_system"]=self["webpackChunkblog_system"]||[]).push([[693],{9693:function(e,a,l){l.r(a),l.d(a,{default:function(){return I}});l(4114);var s=l(6768),r=l(4232);const o={class:"profile-container"},t={class:"profile-header"},i={class:"profile-avatar"},u={class:"avatar-upload"},d={class:"profile-info"},n={class:"user-bio"},p={class:"user-stats"},m={class:"stat-item"},c={class:"stat-value"},f={class:"stat-item"},b={class:"stat-value"},v={class:"stat-item"},w={class:"stat-value"},k={key:0,class:"empty-state"},F={key:1,class:"favorites-list"},g={class:"favorite-info"},_=["onClick"],h={class:"favorite-meta"},L={class:"favorite-actions"};function P(e,a,l,P,V,y){const C=(0,s.g2)("el-avatar"),R=(0,s.g2)("el-button"),U=(0,s.g2)("el-upload"),K=(0,s.g2)("el-input"),A=(0,s.g2)("el-form-item"),I=(0,s.g2)("el-form"),z=(0,s.g2)("el-tab-pane"),E=(0,s.g2)("el-empty"),W=(0,s.g2)("el-tabs"),q=(0,s.g2)("el-card");return(0,s.uX)(),(0,s.CE)("div",o,[(0,s.bF)(q,{class:"profile-card"},{default:(0,s.k6)((()=>[(0,s.Lk)("div",t,[(0,s.Lk)("div",i,[(0,s.bF)(C,{size:100,src:P.userInfo.avatar},null,8,["src"]),(0,s.Lk)("div",u,[(0,s.bF)(U,{class:"avatar-uploader",action:"#","http-request":P.uploadAvatar,"show-file-list":!1,"before-upload":P.beforeAvatarUpload},{default:(0,s.k6)((()=>[(0,s.bF)(R,{size:"small",type:"primary"},{default:(0,s.k6)((()=>a[9]||(a[9]=[(0,s.eW)("更换头像")]))),_:1,__:[9]})])),_:1},8,["http-request","before-upload"])])]),(0,s.Lk)("div",d,[(0,s.Lk)("h1",null,(0,r.v_)(P.userInfo.username),1),(0,s.Lk)("p",n,(0,r.v_)(P.userInfo.bio||"这个人很懒，还没有填写个人简介"),1),(0,s.Lk)("div",p,[(0,s.Lk)("div",m,[(0,s.Lk)("div",c,(0,r.v_)(P.stats.articles),1),a[10]||(a[10]=(0,s.Lk)("div",{class:"stat-label"},"文章",-1))]),(0,s.Lk)("div",f,[(0,s.Lk)("div",b,(0,r.v_)(P.stats.comments),1),a[11]||(a[11]=(0,s.Lk)("div",{class:"stat-label"},"评论",-1))]),(0,s.Lk)("div",v,[(0,s.Lk)("div",w,(0,r.v_)(P.stats.likes),1),a[12]||(a[12]=(0,s.Lk)("div",{class:"stat-label"},"获赞",-1))])])])]),(0,s.bF)(W,{modelValue:P.activeTab,"onUpdate:modelValue":a[8]||(a[8]=e=>P.activeTab=e),class:"profile-tabs"},{default:(0,s.k6)((()=>[(0,s.bF)(z,{label:"个人资料",name:"info"},{default:(0,s.k6)((()=>[(0,s.bF)(I,{model:P.profileForm,rules:P.rules,ref:"profileFormRef","label-width":"100px",class:"profile-form"},{default:(0,s.k6)((()=>[(0,s.bF)(A,{label:"用户名",prop:"username"},{default:(0,s.k6)((()=>[(0,s.bF)(K,{modelValue:P.profileForm.username,"onUpdate:modelValue":a[0]||(a[0]=e=>P.profileForm.username=e)},null,8,["modelValue"])])),_:1}),(0,s.bF)(A,{label:"邮箱",prop:"email"},{default:(0,s.k6)((()=>[(0,s.bF)(K,{modelValue:P.profileForm.email,"onUpdate:modelValue":a[1]||(a[1]=e=>P.profileForm.email=e),disabled:""},null,8,["modelValue"]),a[13]||(a[13]=(0,s.Lk)("div",{class:"form-tip"},"邮箱地址不可修改",-1))])),_:1,__:[13]}),(0,s.bF)(A,{label:"个人简介",prop:"bio"},{default:(0,s.k6)((()=>[(0,s.bF)(K,{modelValue:P.profileForm.bio,"onUpdate:modelValue":a[2]||(a[2]=e=>P.profileForm.bio=e),type:"textarea",rows:4,placeholder:"介绍一下自己吧",maxlength:"200","show-word-limit":""},null,8,["modelValue"])])),_:1}),(0,s.bF)(A,{label:"个人网站",prop:"website"},{default:(0,s.k6)((()=>[(0,s.bF)(K,{modelValue:P.profileForm.website,"onUpdate:modelValue":a[3]||(a[3]=e=>P.profileForm.website=e),placeholder:"http://"},null,8,["modelValue"])])),_:1}),(0,s.bF)(A,{label:"所在地",prop:"location"},{default:(0,s.k6)((()=>[(0,s.bF)(K,{modelValue:P.profileForm.location,"onUpdate:modelValue":a[4]||(a[4]=e=>P.profileForm.location=e)},null,8,["modelValue"])])),_:1}),(0,s.bF)(A,null,{default:(0,s.k6)((()=>[(0,s.bF)(R,{type:"primary",onClick:P.updateProfile,loading:P.updating},{default:(0,s.k6)((()=>a[14]||(a[14]=[(0,s.eW)("保存修改")]))),_:1,__:[14]},8,["onClick","loading"])])),_:1})])),_:1},8,["model","rules"])])),_:1}),(0,s.bF)(z,{label:"修改密码",name:"password"},{default:(0,s.k6)((()=>[(0,s.bF)(I,{model:P.passwordForm,rules:P.passwordRules,ref:"passwordFormRef","label-width":"100px",class:"password-form"},{default:(0,s.k6)((()=>[(0,s.bF)(A,{label:"当前密码",prop:"currentPassword"},{default:(0,s.k6)((()=>[(0,s.bF)(K,{modelValue:P.passwordForm.currentPassword,"onUpdate:modelValue":a[5]||(a[5]=e=>P.passwordForm.currentPassword=e),type:"password","show-password":""},null,8,["modelValue"])])),_:1}),(0,s.bF)(A,{label:"新密码",prop:"newPassword"},{default:(0,s.k6)((()=>[(0,s.bF)(K,{modelValue:P.passwordForm.newPassword,"onUpdate:modelValue":a[6]||(a[6]=e=>P.passwordForm.newPassword=e),type:"password","show-password":""},null,8,["modelValue"]),a[15]||(a[15]=(0,s.Lk)("div",{class:"form-tip"},"密码长度至少为8位，包含大小写字母和数字",-1))])),_:1,__:[15]}),(0,s.bF)(A,{label:"确认新密码",prop:"confirmPassword"},{default:(0,s.k6)((()=>[(0,s.bF)(K,{modelValue:P.passwordForm.confirmPassword,"onUpdate:modelValue":a[7]||(a[7]=e=>P.passwordForm.confirmPassword=e),type:"password","show-password":""},null,8,["modelValue"])])),_:1}),(0,s.bF)(A,null,{default:(0,s.k6)((()=>[(0,s.bF)(R,{type:"primary",onClick:P.updatePassword,loading:P.updatingPassword},{default:(0,s.k6)((()=>a[16]||(a[16]=[(0,s.eW)("更新密码")]))),_:1,__:[16]},8,["onClick","loading"])])),_:1})])),_:1},8,["model","rules"])])),_:1}),(0,s.bF)(z,{label:"我的收藏",name:"favorites"},{default:(0,s.k6)((()=>[0===P.favorites.length?((0,s.uX)(),(0,s.CE)("div",k,[(0,s.bF)(E,{description:"暂无收藏文章"})])):((0,s.uX)(),(0,s.CE)("div",F,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(P.favorites,(l=>((0,s.uX)(),(0,s.CE)("div",{key:l.id,class:"favorite-item"},[(0,s.Lk)("div",g,[(0,s.Lk)("h3",{onClick:a=>e.$router.push(`/article/${l.id}`)},(0,r.v_)(l.title),9,_),(0,s.Lk)("div",h,[(0,s.Lk)("span",null,[a[17]||(a[17]=(0,s.Lk)("i",{class:"el-icon-user"},null,-1)),(0,s.eW)(" "+(0,r.v_)(l.author),1)]),(0,s.Lk)("span",null,[a[18]||(a[18]=(0,s.Lk)("i",{class:"el-icon-date"},null,-1)),(0,s.eW)(" "+(0,r.v_)(l.publishDate),1)]),(0,s.Lk)("span",null,[a[19]||(a[19]=(0,s.Lk)("i",{class:"el-icon-collection-tag"},null,-1)),(0,s.eW)(" "+(0,r.v_)(l.category),1)])])]),(0,s.Lk)("div",L,[(0,s.bF)(R,{size:"small",type:"danger",onClick:e=>P.removeFavorite(l.id),icon:"el-icon-delete",circle:"",plain:""},null,8,["onClick"])])])))),128))]))])),_:1})])),_:1},8,["modelValue"])])),_:1})])}l(8111),l(2489);var V=l(144),y=l(782),C=l(1219);function R(e){const a=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{8,}$/;return a.test(e)}var U={name:"ProfileView",setup(){const e=(0,y.Pj)(),a=(0,V.KR)(null),l=(0,V.KR)(null),r=(0,V.KR)("info"),o=(0,V.KR)(!1),t=(0,V.KR)(!1),i=(0,s.EW)((()=>e.state.user.userInfo||{})),u=(0,V.Kh)({articles:12,comments:48,likes:156}),d=(0,V.Kh)({username:i.value?.username||"",email:i.value?.email||"",bio:i.value?.bio||"",website:i.value?.website||"",location:i.value?.location||""}),n=(0,V.Kh)({currentPassword:"",newPassword:"",confirmPassword:""}),p=(0,V.KR)([]),m={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在3到20个字符之间",trigger:"blur"}],bio:[{max:200,message:"个人简介不能超过200个字符",trigger:"blur"}],website:[{pattern:/^(https?:\/\/)?([\da-z.-]+)\.([a-z.]{2,6})([/\w.-]*)*\/?$/,message:"请输入有效的网址",trigger:"blur"}]},c={currentPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{validator:(e,a,l)=>{R(a)?l():l(new Error("密码长度至少为8位，包含大小写字母和数字"))},trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(e,a,l)=>{a!==n.newPassword?l(new Error("两次输入的密码不一致")):l()},trigger:"blur"}]},f=()=>{a.value.validate((async a=>{if(a){o.value=!0;try{await e.dispatch("user/updateUserInfo",{...i.value,...d}),C.nk.success("个人资料更新成功")}catch(l){C.nk.error("更新个人资料失败")}finally{o.value=!1}}}))},b=()=>{l.value.validate((async e=>{if(e){t.value=!0;try{setTimeout((()=>{C.nk.success("密码更新成功"),n.currentPassword="",n.newPassword="",n.confirmPassword="",t.value=!1}),1e3)}catch(a){C.nk.error("更新密码失败"),t.value=!1}}}))},v=e=>{const a="image/jpeg"===e.type,l="image/png"===e.type,s=e.size/1024/1024<2;return a||l?!!s||(C.nk.error("头像大小不能超过2MB!"),!1):(C.nk.error("头像只能是JPG或PNG格式!"),!1)},w=a=>{const l=a.file,s=new FileReader;s.readAsDataURL(l),s.onload=()=>{e.dispatch("user/updateUserInfo",{...i.value,avatar:s.result}),C.nk.success("头像更新成功")}},k=e=>{p.value=p.value.filter((a=>a.id!==e)),C.nk.success("已从收藏中移除")},F=()=>{p.value=Array.from({length:5},((e,a)=>({id:`fav-${a+1}`,title:`收藏的文章标题 ${a+1}`,author:"王五",publishDate:"2023-05-10",category:"技术"})))};return(0,s.sV)((()=>{Object.assign(d,{username:i.value.username||"",email:i.value.email||"",bio:i.value.bio||"",website:i.value.website||"",location:i.value.location||""}),F()})),{profileFormRef:a,passwordFormRef:l,activeTab:r,userInfo:i,stats:u,profileForm:d,passwordForm:n,favorites:p,rules:m,passwordRules:c,updating:o,updatingPassword:t,updateProfile:f,updatePassword:b,beforeAvatarUpload:v,uploadAvatar:w,removeFavorite:k}}},K=l(1241);const A=(0,K.A)(U,[["render",P],["__scopeId","data-v-373474e6"]]);var I=A}}]);
//# sourceMappingURL=693.981987bb.js.map